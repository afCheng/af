webpackJsonp([5],{Bt7H:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={data:function(){return{teacherNumber:"",is_read:!0,labelPosition:"right",teacherForm:{},myNotList:[],myAllNot:[],returnSearch:"",showModel:!1,pageIndex:1,pageTotal:0,scanningData3:[],scanningSelection:[],notMy:0,ws:"",timer:""}},created:function(){this.$store.state.sideIndex=-1},mounted:function(){},beforeDestroy:function(){this.ws&&this.ws.close(),this.timer&&clearInterval(this.timer)},methods:{checkTeacherNumber:function(){var t=this;""==this.teacherNumber?this.$message({message:"请刷卡！",type:"warning",duration:"1000"}):0==this.teacherNumber?(this.$message({message:"该卡无教师信息！",type:"warning",duration:"1500"}),this.teacherNumber=""):this.$axios.post("/user-list",{number:999999999,id_number:this.teacherNumber}).then(function(e){void 0==e.data.data.data?(t.$message({message:"该卡无教师信息！",type:"warning",duration:"1500"}),t.teacherForm={},t.myReceivedList=[]):(t.teacherForm=e.data.data.data[0],1==t.teacherForm.sex?t.teacherForm.sex_type="男":t.teacherForm.sex_type="女",t.checkMyList(),t.getMyAllNot()),t.teacherNumber=""}).catch(function(t){})},checkMyList:function(){var t=this;this.$axios.post("/receive",{id_number:this.teacherForm.id_number,number:4,page:1}).then(function(e){t.myNotList=e.data.data.data,0==e.data.data.data.length?t.pageTotal=0:t.pageTotal=e.data.data.total}).catch(function(t){})},getMyAllNot:function(){var t=this;this.$axios.post("/receive",{id_number:this.teacherForm.id_number,number:9999999999,page:1}).then(function(e){console.log(e),t.myAllNot=e.data.data.data}).catch(function(t){})},searchNotClick:function(){var t=this;this.$axios.post("/receive",{id_number:this.teacherForm.id_number,number:4,page:1,item_name:this.returnSearch}).then(function(e){t.myNotList=e.data.data.data,0==e.data.data.data.length?t.pageTotal=0:t.pageTotal=e.data.data.total}).catch(function(t){})},handleCurrentChange:function(t){var e=this;this.$axios.post("/receive",{id_number:this.teacherForm.id_number,number:4,page:t,item_name:this.returnSearch}).then(function(t){e.myNotList=t.data.data.data,0==t.data.data.data.length?e.pageTotal=0:e.pageTotal=t.data.data.total}).catch(function(t){})},connectionClick:function(){var t=this;this.ws=new WebSocket("ws://127.0.0.1/tag-pool"),this.ws.onopen=function(e){t.showModel=!0,t.scanningData3=[],t.notMy=0};var e=[];this.ws.onmessage=function(a){var n=[],s=a.data;if(0==JSON.parse(s).length&&(t.scanningData3=[],t.notMy=0),e.sort().toString()==JSON.parse(s).sort().toString());else{for(var i in e=JSON.parse(s))n.push(e[i].epc);0==n.length||t.$axios.post("/frid-sel",{frid_list:n}).then(function(e){if("无数据"==e.data.message)t.$message({type:"warning",message:"请勿扫描未绑定的标签!",duration:"2000"});else{for(var a in t.scanningData3=[],t.notMy=0,e.data.data)null==e.data.data[a][0].photo?t.scanningData3.push({item_name:e.data.data[a][0].item_name,item_id:e.data.data[a][0].item_id,frid_number:e.data.data[a][0].frid_number,sort_name:e.data.data[a][0].sort_name,sort_id:e.data.data[a][0].sort_id,photo:null,usage:"",is_damage:"",remarks:"",amount:e.data.data[a][0].amount,is_beyond:1}):t.scanningData3.push({item_name:e.data.data[a][0].item_name,item_id:e.data.data[a][0].item_id,frid_number:e.data.data[a][0].frid_number,sort_name:e.data.data[a][0].sort_name,sort_id:e.data.data[a][0].sort_id,photo:e.data.data[a][0].photo.split("/")[1],usage:"",is_damage:"",remarks:"",amount:e.data.data[a][0].amount,is_beyond:1});for(var n in t.scanningData3)for(var s in t.myAllNot){if(t.scanningData3[n].frid_number==t.myAllNot[s].frid_number){t.scanningData3[n].isMy=1,t.myAllNot[s].status_at>0?t.scanningData3[n].is_overdue=0:t.scanningData3[n].is_overdue=1;break}t.scanningData3[n].isMy=2}for(var i in t.scanningData3)1==t.scanningData3[i].isMy||t.notMy++;console.log(t.scanningData3)}}).catch(function(t){})}},this.ws.onclose=function(t){},this.ws.onerror=function(e){t.$message({message:"请先连接硬件并开启软件！",type:"warning",duration:"2000"}),t.ws=""}},closeBox:function(){this.showModel=!1,this.scanningData3=[],this.notMy=0},tableRowClassName:function(t){var e=t.row;t.rowIndex;if(1!=e.isMy)return"warning-more"},handleSelectionChange:function(t){this.scanningSelection=t},confirmBox:function(){var t=this;if(console.log(this.scanningData3),console.log(this.scanningSelection),0==this.scanningSelection.length)this.$message({message:"请先选择最终要归还的物品！",type:"warning",duration:"1500"});else{var e=!0,a=!0,n=!0,s=!0;for(var i in this.scanningSelection)if(2==this.scanningSelection[i].isMy){a=!1;break}for(var o in this.scanningSelection){if(""==this.scanningSelection[o].usage||""==this.scanningSelection[o].is_damage||""==this.scanningSelection[o].remarks){e=!1;break}isNaN(this.scanningSelection[o].usage)?(this.scanningSelection[o].is_beyond=2,n=!1):Number(this.scanningSelection[o].usage)<=Number(this.scanningSelection[o].amount)||(this.scanningSelection[o].is_beyond=2,s=!1)}if(a)if(e)if(n)if(s){this.teacherForm.id,JSON.parse(localStorage.getItem("user")).name;var r=this.scanningSelection;for(var l in r)r[l].user_id=this.teacherForm.id,r[l].site_use="无",r[l].recipient=JSON.parse(localStorage.getItem("user")).name;this.$axios.post("/restore-edit",{restore:r}).then(function(e){"0"==e.data.status&&(t.$message({message:"归还成功！",type:"success",duration:"1500"}),t.showModel=!1,t.checkMyList(),t.getMyAllNot(),t.scanningSelection=[],t.scanningData3=[])}).catch(function(t){})}else this.$message({message:"填写的剩余量已超出库存量！",type:"warning",duration:"1500"});else this.$message({message:"填写的剩余量应为数字值！",type:"warning",duration:"1500"});else this.$message({message:"请填写相关数据！",type:"warning",duration:"1000"});else this.$message({message:"只能归还本人未归还列表中的物品！",type:"warning",duration:"1500"})}}},filters:{over_status:function(t){return t>0?"逾期"+t+"天":0==t?"今天到期":Math.abs(t)+"天后到期"},is_over:function(t){return t<=0?"否":"是"}}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"return"},[t._m(0),t._v(" "),a("div",{staticClass:"people"},[t._v("个人信息")]),t._v(" "),a("div",{staticClass:"Information"},[a("div",{staticClass:"Left"},[a("div",{staticClass:"LeftImg"}),t._v(" "),a("el-input",{staticClass:"p_search",attrs:{type:"password",placeholder:"请刷卡识别"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.checkTeacherNumber()}},model:{value:t.teacherNumber,callback:function(e){t.teacherNumber=e},expression:"teacherNumber"}})],1),t._v(" "),a("div",{staticClass:"ipt"},[a("el-form",{attrs:{"label-position":t.labelPosition,"label-width":"80px",model:t.teacherForm}},[a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{attrs:{readonly:t.is_read,unselectable:"on"},model:{value:t.teacherForm.name,callback:function(e){t.$set(t.teacherForm,"name",e)},expression:"teacherForm.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"性别"}},[a("el-input",{attrs:{readonly:t.is_read,unselectable:"on"},model:{value:t.teacherForm.sex_type,callback:function(e){t.$set(t.teacherForm,"sex_type",e)},expression:"teacherForm.sex_type"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"教师编号"}},[a("el-input",{attrs:{readonly:t.is_read,unselectable:"on"},model:{value:t.teacherForm.id_number,callback:function(e){t.$set(t.teacherForm,"id_number",e)},expression:"teacherForm.id_number"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"职位"}},[a("el-input",{attrs:{readonly:t.is_read,unselectable:"on"},model:{value:t.teacherForm.position,callback:function(e){t.$set(t.teacherForm,"position",e)},expression:"teacherForm.position"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"联系方式"}},[a("el-input",{attrs:{readonly:t.is_read,unselectable:"on"},model:{value:t.teacherForm.call,callback:function(e){t.$set(t.teacherForm,"call",e)},expression:"teacherForm.call"}})],1)],1)],1)]),t._v(" "),a("div",{staticClass:"people"},[t._v("未归还物品列表")]),t._v(" "),a("div",{staticClass:"apply"},[a("div",{staticClass:"Search"},[a("div",{staticClass:"search_input el-input el-input--suffix"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.returnSearch,expression:"returnSearch"}],staticClass:"p_search el-input__inner",attrs:{autocomplete:"off",placeholder:"请输入要搜索的物品名称",type:"text",rows:"2",validateevent:"true",suffixicon:"el-icon-search"},domProps:{value:t.returnSearch},on:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter")&&t._k(e.keyCode,"active",void 0,e.key,void 0))return null;t.searchNotClick()},input:function(e){e.target.composing||(t.returnSearch=e.target.value)}}}),t._v(" "),a("span",{staticClass:"el-input__suffix",on:{click:function(e){t.searchNotClick()}}},[t._m(1)])])])]),t._v(" "),a("el-button",{staticClass:"left_btn",style:t.teacherForm.id_number?"":"display:none;",attrs:{type:"primary"},on:{click:function(e){t.connectionClick()}}},[t._v("归还")]),t._v(" "),t.showModel?a("div",{staticClass:"ModelUse"},[a("div",{staticClass:"Model"},[a("div",{staticClass:"ModelT"},[a("span",[t._v("归还物品")]),t._v(" "),a("i",{staticClass:"el-icon-close",on:{click:function(e){t.closeBox()}}})]),t._v(" "),a("div",{staticClass:"ModelMain"},[a("div",{staticClass:"ModelTop"},[t._v("归还物品扫描结果")]),t._v(" "),a("div",{staticClass:"table_main"},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.scanningData3,stripe:"","tooltip-effect":"dark","row-class-name":t.tableRowClassName},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),a("el-table-column",{attrs:{prop:"item_id",label:"物品编号",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"item_name",label:"物品名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"pic",label:"物品图片",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.photo?a("img",{staticStyle:{width:"71px",height:"30px"},attrs:{src:t.$store.state.operationPhotoPath+e.row.photo}}):t._e(),t._v(" "),e.row.photo?t._e():a("span",[t._v("无")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"sort_name",label:"分类"}}),t._v(" "),a("el-table-column",{attrs:{prop:"usage",label:"剩余量"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{class:2==e.row.is_beyond?"is_beyond":"",attrs:{type:"text"},nativeOn:{keyup:function(t){e.row.is_beyond=1}},model:{value:e.row.usage,callback:function(a){t.$set(e.row,"usage",a)},expression:"scope.row.usage"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"是否损坏",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-select",{attrs:{placeholder:""},model:{value:e.row.is_damage,callback:function(a){t.$set(e.row,"is_damage",a)},expression:"scope.row.is_damage"}},[a("el-option",{key:"0",attrs:{label:"是",value:"0"}}),t._v(" "),a("el-option",{key:"1",attrs:{label:"否",value:"1"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"remarks",label:"备注",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{type:"text"},model:{value:e.row.remarks,callback:function(a){t.$set(e.row,"remarks",a)},expression:"scope.row.remarks"}})]}}])})],1)],1),t._v(" "),a("div",{staticClass:"ModelBtm"},[t._v("扫描结果：合计"+t._s(t.scanningData3.length)+"件物品，"),a("span",{staticStyle:{color:"#f05050"}},[t._v(t._s(t.notMy))]),t._v("件物品不在归还列表范围，明细请参照上面列表。")]),t._v(" "),a("el-button",{staticClass:"Models_btn",attrs:{type:"primary"},on:{click:function(e){t.confirmBox()}}},[t._v("确认扫描结果无误")])],1)])]):t._e(),t._v(" "),a("div",{staticClass:"table_list"},[a("el-table",{ref:"NotTable",staticStyle:{width:"100%"},attrs:{data:t.myNotList,stripe:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{type:"index",label:"序号",width:"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"item_id",label:"物品编号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"item_name",label:"物品名称","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"receive_at",label:"领用时间","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"overdue_at",label:"逾期时间","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{style:e.row.status_at>0?"color: #f05050;":""},[t._v("\n                        "+t._s(t._f("over_status")(e.row.status_at))+"\n                    ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"是否逾期"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("is_over")(e.row.status_at)))])]}}])})],1)],1),t._v(" "),a("div",{staticClass:"block",staticStyle:{"text-align":"center","margin-top":"30px"}},[a("el-pagination",{attrs:{"current-page":t.pageIndex,"page-size":4,layout:"total, prev, pager, next, jumper",total:t.pageTotal},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.pageIndex=e}}})],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"bread_crumb"},[e("span",[this._v("当前位置：")]),this._v(" "),e("span",[this._v("快速归还")]),e("br")])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"el-input__suffix-inner"},[e("i",{staticClass:"el-input__icon iconfont el-icon-pharmaceutical_administration-sousuo"})])}]};var i=a("VU/8")(n,s,!1,function(t){a("y7lU")},null,null);e.default=i.exports},y7lU:function(t,e){}});
//# sourceMappingURL=5.7649118bfc2ffdff4556.js.map