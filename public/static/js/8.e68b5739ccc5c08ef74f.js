webpackJsonp([8],{gza8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),n=a("pFYg"),o=a.n(n),l={data:function(){return{singleIndex:0,teachersList:[],labelPosition:"right",is_read:!0,teacherNumber:"",teacherForm:{},receivedSearch:"",showNew:!1,myReceivedList:[],multipleReceivedSelection:[],manifestGoodsList:[],scanningData:[],lackData:[],notIn:0,abnormal:0,chooseSelection:[],pickerOptions1:{disabledDate:function(e){return e.getTime()>Date.now()},shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]},startValue:"",endValue:"",receive_at:"",overdue_at:"",ws:"",timer:""}},created:function(){this.$store.state.sideIndex=-1},mounted:function(){this.getTeacherLists()},beforeDestroy:function(){this.ws&&this.ws.close(),this.timer&&clearInterval(this.timer)},methods:{getTeacherLists:function(){var e=this;this.$axios.post("/user-list",{number:9999999}).then(function(t){e.teachersList=t.data.data.data}).catch(function(e){})},checkTeacherNumber:function(){var e=this;""==this.teacherNumber?this.$message({message:"请刷卡！",type:"warning",duration:"1000"}):0==this.teacherNumber?(this.$message({message:"该卡无教师信息！",type:"warning",duration:"1500"}),this.teacherNumber=""):this.$axios.post("/user-list",{number:999999999,id_number:this.teacherNumber}).then(function(t){void 0==t.data.data.data?(e.$message({message:"该卡无教师信息！",type:"warning",duration:"1500"}),e.teacherForm={},e.myReceivedList=[]):(e.$message({type:"success",message:"刷卡成功!",duration:"1500"}),e.teacherForm=t.data.data.data[0],1==e.teacherForm.sex?e.teacherForm.sex_type="男":e.teacherForm.sex_type="女",e.checkMyList()),e.teacherNumber=""}).catch(function(e){})},checkMyList:function(){var e=this;this.myReceivedList=[],this.$axios.post("/manifest-list",{user_id:this.teacherForm.id}).then(function(t){for(var a in t.data.data)1==t.data.data[a].is_receive&&e.myReceivedList.push(t.data.data[a])}).catch(function(e){})},searchReceivedClick:function(){var e=this;this.myReceivedList=[],this.$axios.post("/manifest-list",{user_id:this.teacherForm.id,item_use:this.receivedSearch,t_start:this.startValue,t_end:this.endValue}).then(function(t){for(var a in t.data.data)1==t.data.data[a].is_receive&&e.myReceivedList.push(t.data.data[a])}).catch(function(e){})},changeStartDate:function(){if(null==this.startValue)this.startValue="";else{var e=new Date(this.startValue),t=e.getFullYear()+"-",a=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",i=e.getDate()<10?"0"+e.getDate():e.getDate();this.startValue=t+a+i}},changeEndDate:function(){if(null==this.endValue)this.endValue="";else{var e=new Date(this.endValue),t=e.getFullYear()+"-",a=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",i=e.getDate()<10?"0"+e.getDate():e.getDate();this.endValue=t+a+i}},handleCurrentChange:function(e){if(1==this.multipleReceivedSelection.length)if(this.multipleReceivedSelection[0]==e)this.singleIndex=0,this.multipleReceivedSelection=[];else{this.singleIndex=e;var t=[];t.push(e),this.multipleReceivedSelection=t,this.getManifestGood()}else{this.singleIndex=e;var a=[];a.push(e),this.multipleReceivedSelection=a,this.getManifestGood()}},handleReceivedChange:function(e){this.multipleReceivedSelection=e,1==e.length&&this.getManifestGood()},changeSomeTime:function(){var e=new Date,t=e.getFullYear()+"-",a=(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-",i=e.getDate()<10?"0"+e.getDate():e.getDate();this.receive_at=t+a+i;var s=new Date(Date.parse(new Date)+6048e5),n=s.getFullYear()+"-",o=(s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1)+"-",l=s.getDate()<10?"0"+s.getDate():s.getDate();this.overdue_at=n+o+l},getManifestGood:function(){var e=this;this.$axios.post("/apply-list",{manifest_id:this.multipleReceivedSelection[0].id}).then(function(t){e.manifestGoodsList=t.data.data,e.$axios.post("/sort-list").then(function(t){for(var a in e.manifestGoodsList)for(var i in t.data.data)e.manifestGoodsList[a].item_name==t.data.data[i].name&&(e.manifestGoodsList[a].sort_id=t.data.data[i].id)}).catch(function(e){})}).catch(function(e){})},connectionClick:function(){var e=this;this.ws=new WebSocket("ws://127.0.0.1/tag-pool"),this.ws.onopen=function(t){e.showNew=!0,e.notIn=0,e.abnormal=0,e.scanningData=[],e.lackData=[]};var t=[];this.ws.onmessage=function(a){var i=[],s=a.data;if(0==JSON.parse(s).length&&(e.lackData=e.manifestGoodsList),t.sort().toString()==JSON.parse(s).sort().toString());else{t=JSON.parse(s),console.log(t);for(var n=0;n<t.length;n++)null==t[n]||i.push(t[n].epc);e.scanningData=[],e.lackData=[],e.notIn=0,e.abnormal=0,0==i.length||e.$axios.post("/frid-sel",{frid_list:i}).then(function(t){if("无数据"==t.data.message)e.$message({type:"warning",message:"请勿扫描未绑定的标签!",duration:"2000"});else{for(var a in e.notIn=0,e.abnormal=0,e.scanningData=[],e.lackData=[],e.manifestGoodsList)e.manifestGoodsList[a].isHas=2;for(var i in t.data.data)e.scanningData.push({item_name:t.data.data[i][0].item_name,item_id:t.data.data[i][0].item_id,frid_number:t.data.data[i][0].frid_number,sort_id:t.data.data[i][0].sort_id,status:t.data.data[i][0].status});for(var s in e.scanningData)for(var n in e.manifestGoodsList)if(e.manifestGoodsList[n].item_name==e.scanningData[s].item_name){e.scanningData[s].isHas=1,e.manifestGoodsList[n].isHas=1;break}for(var o in e.scanningData)1==e.scanningData[o].isHas||e.notIn++,1==e.scanningData[o].status&&e.abnormal++;for(var l in e.manifestGoodsList)1==e.manifestGoodsList[l].isHas||e.lackData.push(e.manifestGoodsList[l])}}).catch(function(e){})}},this.ws.onclose=function(e){},this.ws.onerror=function(t){e.$message({message:"请先连接硬件并开启软件！",type:"warning",duration:"2000"}),e.ws=""}},checkboxInit:function(e,t){return 1==e.status?0:1},tableRowClassName:function(e){var t=e.row;e.rowIndex;return 1==t.status?1==t.isHas?"warning-abnormal":"warning-more":1!=t.isHas?"warning-more":void 0},handleChooseChange:function(e){this.chooseSelection=e},closeBox:function(){this.scanningData=[],this.lackData=[],this.showNew=!1},getConfirm:function(){var e=this;if(0==this.chooseSelection.length)this.$message({message:"请先选择最终要领取的物品！",type:"warning",duration:"1500"});else{this.changeSomeTime();var t=this.chooseSelection,a="";for(var i in a=null==this.multipleReceivedSelection[0].remarks?"无":this.multipleReceivedSelection[0].remarks,t)t[i].user_id=this.multipleReceivedSelection[0].user_id,t[i].manifest_id=this.multipleReceivedSelection[0].id,t[i].site_use="无",t[i].remarks=a,t[i].item_use=this.multipleReceivedSelection[0].item_use,t[i].approver=this.multipleReceivedSelection[0].approver,t[i].recipient=JSON.parse(localStorage.getItem("user")).name,t[i].receive_at=this.receive_at,t[i].overdue_at=this.overdue_at;this.$axios.post("/receive-edit",{receive:t,manifest_id:this.multipleReceivedSelection[0].id}).then(function(t){0==t.data.status&&(e.$message({message:"领用成功！",type:"success",duration:"1500"}),e.checkMyList(),e.showNew=!1)}).catch(function(e){})}},unique:function(e){var t={};return e.filter(function(e,a,i){return!t.hasOwnProperty((void 0===e?"undefined":o()(e))+s()(e))&&(t[(void 0===e?"undefined":o()(e))+s()(e)]=!0)})}},filters:{r_at:function(e){return e?e.split(" ")[0]:""}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"received"},[e._m(0),e._v(" "),a("div",{staticClass:"people"},[e._v("个人信息")]),e._v(" "),a("div",{staticClass:"Information"},[a("div",{staticClass:"Left"},[a("div",{staticClass:"LeftImg"}),e._v(" "),a("el-input",{staticClass:"p_search",attrs:{type:"password",placeholder:"请刷卡识别"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.checkTeacherNumber()}},model:{value:e.teacherNumber,callback:function(t){e.teacherNumber=t},expression:"teacherNumber"}})],1),e._v(" "),a("div",{staticClass:"ipt"},[a("el-form",{attrs:{"label-position":e.labelPosition,"label-width":"80px",model:e.teacherForm}},[a("el-form-item",{attrs:{label:"姓名"}},[a("el-input",{attrs:{readonly:e.is_read,unselectable:"on"},model:{value:e.teacherForm.name,callback:function(t){e.$set(e.teacherForm,"name",t)},expression:"teacherForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"性别"}},[a("el-input",{attrs:{readonly:e.is_read,unselectable:"on"},model:{value:e.teacherForm.sex_type,callback:function(t){e.$set(e.teacherForm,"sex_type",t)},expression:"teacherForm.sex_type"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"教师编号"}},[a("el-input",{attrs:{readonly:e.is_read,unselectable:"on"},model:{value:e.teacherForm.id_number,callback:function(t){e.$set(e.teacherForm,"id_number",t)},expression:"teacherForm.id_number"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"职位"}},[a("el-input",{attrs:{readonly:e.is_read,unselectable:"on"},model:{value:e.teacherForm.position,callback:function(t){e.$set(e.teacherForm,"position",t)},expression:"teacherForm.position"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"联系方式"}},[a("el-input",{attrs:{readonly:e.is_read,unselectable:"on"},model:{value:e.teacherForm.call,callback:function(t){e.$set(e.teacherForm,"call",t)},expression:"teacherForm.call"}})],1)],1)],1)]),e._v(" "),a("div",{staticClass:"people"},[e._v("领用申请记录")]),e._v(" "),a("div",{staticClass:"apply"},[a("div",{staticClass:"block block_time"},[a("span",{staticClass:"demonstration"},[e._v("开始时间")]),e._v(" "),a("el-date-picker",{staticClass:"p_search",attrs:{type:"date",placeholder:"选择日期"},on:{change:function(t){e.changeStartDate()}},model:{value:e.startValue,callback:function(t){e.startValue=t},expression:"startValue"}})],1),e._v(" "),a("div",{staticClass:"block block_time"},[a("span",{staticClass:"demonstration"},[e._v("结束时间")]),e._v(" "),a("el-date-picker",{staticClass:"p_search",attrs:{type:"date",placeholder:"选择日期"},on:{change:function(t){e.changeEndDate()}},model:{value:e.endValue,callback:function(t){e.endValue=t},expression:"endValue"}},[e._v(">\n            ")])],1),e._v(" "),a("div",{staticClass:"Search"},[a("div",{staticClass:"search_input el-input el-input--suffix"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.receivedSearch,expression:"receivedSearch"}],staticClass:"el-input__inner p_search",attrs:{autocomplete:"off",placeholder:"请输入要搜索的申请名称",type:"text",rows:"2",validateevent:"true",suffixicon:"el-icon-search"},domProps:{value:e.receivedSearch},on:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")&&e._k(t.keyCode,"active",void 0,t.key,void 0))return null;e.searchReceivedClick()},input:function(t){t.target.composing||(e.receivedSearch=t.target.value)}}}),e._v(" "),a("span",{staticClass:"el-input__suffix",on:{click:function(t){e.searchReceivedClick()}}},[e._m(1)])])])]),e._v(" "),a("el-button",{class:0==e.multipleReceivedSelection.length?"unShow":"right_btn",attrs:{type:"primary"},on:{click:function(t){e.connectionClick()}}},[e._v("领用核查")]),e._v(" "),e.showNew?a("div",{staticClass:"ModelUse"},[a("div",{staticClass:"Model"},[a("div",{staticClass:"ModelT"},[a("span",[e._v("快速领用")]),e._v(" "),a("i",{staticClass:"el-icon-close",on:{click:function(t){e.closeBox()}}})]),e._v(" "),a("div",{staticClass:"ModelMain"},[a("div",{staticClass:"stock_box",staticStyle:{height:"430px"}},[a("div",{staticClass:"ModelLeft"},[a("div",{staticClass:"Model_title"},[e._v("申领与扫描对照表")]),e._v(" "),a("div",{staticClass:"Model_table"},[a("el-table",{ref:"scanningTable",staticStyle:{width:"100%"},attrs:{data:e.scanningData,stripe:"","tooltip-effect":"dark","max-height":"379","row-class-name":e.tableRowClassName},on:{"selection-change":e.handleChooseChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",selectable:e.checkboxInit}}),e._v(" "),a("el-table-column",{attrs:{prop:"item_id",label:"物品编号",width:"129"}}),e._v(" "),a("el-table-column",{attrs:{prop:"item_name",label:"物品名称",width:"129"}})],1)],1)]),e._v(" "),e._m(2),e._v(" "),a("div",{staticClass:"ModelRight"},[a("div",{staticClass:"Model_title"},[e._v("扫描后缺少物品列表")]),e._v(" "),a("div",{staticClass:"Model_table"},[a("el-table",{ref:"lackTable",staticStyle:{width:"100%"},attrs:{data:e.lackData,stripe:"","tooltip-effect":"dark","max-height":"379"}},[a("el-table-column",{attrs:{prop:"item_name",label:"物品名称",width:"129"}}),e._v(" "),a("el-table-column",{attrs:{label:"数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.stock)+e._s(t.row.unit))])]}}])})],1)],1)])]),e._v(" "),a("div",{staticClass:"ModelBtm"},[e._v("扫描结果：合计"+e._s(e.scanningData.length)+"件物品，"),a("span",{staticStyle:{color:"#f05050"}},[e._v(e._s(e.notIn))]),e._v("件不在申领表格范围，本次共缺少"),a("span",{staticStyle:{color:"#f05050"}},[e._v(e._s(e.lackData.length))]),e._v("件物品，且"),a("span",{staticStyle:{color:"#f05050"}},[e._v(e._s(e.abnormal))]),e._v("件物品存在异常不可领取，明细请参照上面列表。")]),e._v(" "),a("el-button",{staticClass:"Model_btn",attrs:{type:"primary"},on:{click:function(t){e.getConfirm()}}},[e._v("确认扫描结果无误")])],1)])]):e._e(),e._v(" "),a("div",{staticClass:"received_table"},[a("el-table",{ref:"myReceivedTable",staticClass:"m_table",staticStyle:{width:"100%"},attrs:{data:e.myReceivedList,stripe:"","tooltip-effect":"dark","max-height":"300"}},[a("el-table-column",{attrs:{width:"55"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"single el-icon-circle-check",class:e.singleIndex.id==t.row.id?"click":"",on:{click:function(a){e.handleCurrentChange(t.row)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"序号",type:"index",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"申领人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"item_use",label:"申请名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"申请时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e._f("r_at")(t.row.created_at)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"list",label:"申领物品清单","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"approver",label:"审批人","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"remarks",label:"备注","show-overflow-tooltip":""}})],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bread_crumb"},[t("span",[this._v("当前位置：")]),this._v(" "),t("span",[this._v("快速领用")]),t("br")])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"el-input__suffix-inner"},[t("i",{staticClass:"el-input__icon iconfont el-icon-pharmaceutical_administration-sousuo"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"ModelIcon"},[t("span",{staticClass:"el-icon-sort-down"}),this._v(" "),t("i",{staticClass:"el-icon-sort-down"})])}]};var r=a("VU/8")(l,c,!1,function(e){a("qArz")},null,null);t.default=r.exports},qArz:function(e,t){}});
//# sourceMappingURL=8.e68b5739ccc5c08ef74f.js.map