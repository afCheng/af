webpackJsonp([2],{IE5m:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});e("g3Gj");var s=e("iqGf"),i={components:{videoPlayer:s.videoPlayer},data:function(){return{project_id:"",maxNode:[],maxNodeIndex:"",showMaxTitle:"",videoMax:"",videoOptions1:{muted:!1,language:"en",autoplay:!0,sources:[{type:"video/mp4",src:""}]},pictureMax:"",textMax:"",subject:{id:"",score:"",describe:"",answer:""},answerCounts:0,maxReference:"",showMaxReference:!1,showMaxReferenceDetail:!1,allAnswer:[],scoreUserCount:0,scoreLinkGroup:[],maxScoreRank:[],scoreMaxTotal:0,rankMaxIndex:"",rankStatus:!1,timeStatus:"",showMaxClock:!1,max_time:"",max_timer:"",maxDownTime:0,flags:!1,videoOptions:{sources:[{type:"rtmp/mp4",src:"",withCredentials:!1}],techOrder:["flash"],language:"zh-CN",live:!0,autoplay:!0,poster:"./static/waitingLive.jpeg",height:1e3}}},created:function(){this.$store.state.loading=!0,this.project_id=localStorage.drill_project,this.getMaxLink(),this.getMaxGroup()},mounted:function(){var t=this;this.timeStatus=setInterval(function(){t.getMaxDrillStatus(),"显示所有组答案"!=t.showMaxTitle&&"开始点评"!=t.showMaxTitle&&"开始打分"!=t.showMaxTitle||t.maxAnswerStatus(),"开始答题"==t.showMaxTitle&&t.getAnswerCount(),"开始打分"==t.showMaxTitle&&t.checkRecordCount(),"开始点评"==t.showMaxTitle&&(t.videoOptions.sources[0].src="rtmp://pili-live-rtmp.jiaxingyanlian.com/emergency-drill/php-sdk-test1517368506")},2e3)},beforeDestroy:function(){clearInterval(this.max_timer)},methods:{NewDate:function(t){var a=t.split(" "),e=a[0].split("-"),s=a[a.length-1].split(":"),i=new Date;return i.setUTCFullYear(e[0],e[1]-1,e[2]),i.setUTCHours(s[0]-8,s[1],s[2]),i},getMaxGroup:function(){var t=this;this.$axios.post("/api/group-start",{design_id:this.project_id}).then(function(a){t.groupLists=a.data.data}).catch(function(){})},maxRandomColor:function(t){return["#f2c840","#50e3c2","#e38df5","#80c6f7","#a1eaff","#f2c840","#50e3c2","#e38df5","#80c6f7","#a1eaff","#f2c840","#50e3c2","#e38df5","#80c6f7","#a1eaff","#f2c840","#50e3c2","#e38df5","#80c6f7","#a1eaff","#f2c840","#50e3c2","#e38df5","#80c6f7","#a1eaff","#f2c840","#50e3c2","#e38df5","#80c6f7","#a1eaff"][t]},getMaxLink:function(){var t=this;this.$axios.post("/api/start",{design_id:this.project_id}).then(function(a){0==a.data.status&&(t.maxNode=a.data.data.node_name)}).catch(function(t){})},getMaxDrillStatus:function(){var t=this,a={};this.$axios.post("/api/look-status",{design_id:this.project_id}).then(function(e){if(e.data.data.design_location)if((a=JSON.parse(e.data.data.design_location)).step==t.showMaxTitle);else{for(var s in"开始点评"==a.step?t.$store.state.loading=!1:t.$store.state.loading=!0,t.maxNode)t.maxNode[s].id==a.node_id&&(t.maxNodeIndex=s);t.showMaxTitle=a.step,"播放素材"==t.showMaxTitle?(t.getMaterials(),t.textMax=t.maxNode[t.maxNodeIndex].description):"播放题目"==t.showMaxTitle||"开始答题"==t.showMaxTitle?t.getMaxSubjects():"显示所有组答案"==t.showMaxTitle?(t.getMaxSubjects(),t.getMaxGroup()):"开始点评"==t.showMaxTitle?(console.log("点评"),t.getMaxSubjects()):"开始打分"==t.showMaxTitle?t.getMaxSubjects():"展示得分"==t.showMaxTitle?(t.showMaxReference=!1,t.getTotalPoints(),t.getMaxScore(),t.getMaxRank()):"结束演练"==t.showMaxTitle&&(t.rankStatus||(t.getTotalPoints(),t.getMaxRank(),t.rankStatus=!0)),clearInterval(t.max_timer),a.end_time?t.$axios.post("/api/time-end").then(function(e){var s=t.NewDate(e.data.data);t.maxDownTime=(a.end_time-s)/1e3,t.maxDownTime<=0?(t.flags=!1,clearInterval(t.max_timer),t.$store.state.loading=!0):t.max_timer=setInterval(function(){1==t.flags&&(t.$store.state.loading=!0,clearInterval(t.max_timer)),t.timeDowns()},1e3)}).catch(function(t){}):(t.showMaxClock=!1,clearInterval(t.timer))}}).catch(function(t){})},timeDowns:function(){var t=parseInt(this.maxDownTime),a=this.formate(parseInt(t/60%60)),e=this.formate(parseInt(t%60));this.showMaxClock=!0,t<=0&&(this.flags=!0,this.$emit("time-end")),t<0&&(this.showMaxClock=!1),this.max_time=a+":"+e,this.maxDownTime--},formate:function(t){return t>=10?t:"0"+t},getMaterials:function(){var t=this,a="",e="";this.$axios.post("/api/play-video",{node_id:this.maxNode[this.maxNodeIndex].id}).then(function(s){var i=["gif","jpeg","jpg","bmp","png"];for(var o in s.data.data)RegExp(".("+i.join("|")+")$","i").test(s.data.data[o].file_path.toLowerCase())?e=s.data.data[o].original_file:a=s.data.data[o].original_file;t.videoMax=a,t.videoOptions1.sources[0].src=t.$store.state.file_path+a,t.pictureMax=e,t.$store.state.loading=!1}).catch(function(t){})},getMaxSubjects:function(){var t=this;this.$axios.post("/api/play-problem",{node_id:this.maxNode[this.maxNodeIndex].id}).then(function(a){t.subject=a.data.data[0].problem,"显示所有组答案"==t.showMaxTitle||"开始打分"==t.showMaxTitle?(null!=t.subject.answer&&(t.showMaxReference=!0,t.maxReference=t.subject.answer,t.$axios.post("/api/problem-status",{problem_id:t.subject.id}).then(function(a){1==a.data.data.status?(t.showMaxReference=!0,t.$nextTick(function(){var t=document.getElementsByClassName("reference_content");t[0].childNodes[0].childNodes[0].offsetHeight<75&&t[0].setAttribute("class","reference_content have_not")})):t.showMaxReference=!1}).catch(function(t){})),t.getMaxAnswer()):"开始答题"==t.showMaxTitle||(t.showMaxTitle,t.$store.state.loading=!1)}).catch(function(t){})},getAnswerCount:function(){var t=this;this.$axios.post("/api/answer-user",{design_id:this.project_id,problem_id:this.subject.id}).then(function(a){t.answerCounts=a.data.data.length,t.$store.state.loading=!1}).catch(function(t){})},maxAnswerStatus:function(){var t=this,a="";this.$axios.post("/api/play-problem",{node_id:this.maxNode[this.maxNodeIndex].id}).then(function(e){e.data.data&&(a=e.data.data[0].problem.id,t.$axios.post("/api/problem-status",{problem_id:a}).then(function(a){1==a.data.data.status?(t.showMaxReference=!0,t.$nextTick(function(){var t=document.getElementsByClassName("reference_content");t[0].childNodes[0].childNodes[0].offsetHeight<75&&t[0].setAttribute("class","reference_content have_not")})):t.showMaxReference=!1}).catch(function(t){}))}).catch(function(t){})},getMaxAnswer:function(){var t=this;this.allAnswer=[];var a=this.groupLists;this.$axios.post("/api/play-answer",{problem_id:this.subject.id}).then(function(e){if("此演练不分组"==a[0].name){var s=[];for(var i in e.data.data)s.push({name:e.data.data[i].user.name,answer:e.data.data[i].answer,answer_id:e.data.data[i].id,show:!0});a=s}else for(var o in e.data.data)for(var n in a)a[n].show=1,e.data.data[o].user_id==a[n].group_user&&(a[n].answer=e.data.data[o].answer,a[n].answer_id=e.data.data[o].id);var r=[];for(var c in a)a[c].answer_id&&r.push(a[c]);t.allAnswer=r,t.$nextTick(function(){for(var t=document.getElementsByClassName("answer"),a=0;a<t.length;a++){t[a].childNodes[0].childNodes[0].offsetHeight<75&&t[a].setAttribute("class","answer hide_btn")}}),"开始打分"==t.showMaxTitle||(t.$store.state.loading=!1)}).catch(function(t){})},checkRecordCount:function(){var t=this,a="";this.$axios.post("/api/play-problem",{node_id:this.maxNode[this.maxNodeIndex].id}).then(function(e){e.data.data&&(a=e.data.data[0].problem.id,t.$axios.post("/api/score-user",{design_id:t.project_id,problem_id:a}).then(function(a){var e=[];if(a.data.data){for(var s in e.push(a.data.data[0]),a.data.data)e[0].user_id==a.data.data[s].user_id&&e.push(a.data.data[s]);t.scoreUserCount=e.length-1}else t.scoreUserCount=0;t.$store.state.loading=!1}).catch(function(t){}))}).catch(function(t){})},maxAnswerDetail:function(t,a){for(var e in this.allAnswer)this.allAnswer[e].id==t&&(this.allAnswer[e].show=!a);this.showTitleA="",this.showTitleA="显示所有组答案"},getMaxScore:function(){var t=this,a="",e=[];this.$axios.post("/api/play-problem",{node_id:this.maxNode[this.maxNodeIndex].id}).then(function(s){s.data.data&&(a=s.data.data[0].problem.id,t.$axios.post("/api/score-node",{design_id:t.project_id,problem_id:a}).then(function(a){if(0==a.data.status)if("此演练不分组"==t.groupLists[0].name){var s=a.data.data;for(var i in a.data.data)s[i].name=a.data.data[i].user_name;e=s}else for(var o in t.groupLists)for(var n in a.data.data)a.data.data[n].user_id==t.groupLists[o].group_user&&e.push({name:t.groupLists[o].name,score:a.data.data[n].score});t.scoreLinkGroup=e,t.$store.state.loading=!1}).catch(function(t){}))})},getTotalPoints:function(){var t=this;for(var a in this.scoreMaxTotal=0,this.maxNode)this.$axios.post("/api/play-problem",{node_id:this.maxNode[a].id}).then(function(a){var e=a.data.data[0].problem.score;t.scoreMaxTotal=t.scoreMaxTotal+e}).catch(function(t){})},getMaxRank:function(){var t=this,a=[];this.$axios.post("/api/accord-rank",{design_id:this.project_id}).then(function(e){a=e.data.data;for(var s=0;s<e.data.data.length;s++)0===s?a[s].src="./static/first.png":1===s?a[s].src="./static/second.png":2===s?a[s].src="./static/third.png":3===s&&(a[s].src="./static/fourth.png");t.maxScoreRank=a,t.maxScoreRank.length>=4?t.rankMaxIndex="四":3==t.maxScoreRank.length?t.rankMaxIndex="三":2==t.maxScoreRank.length?t.rankMaxIndex="二":1==t.maxScoreRank.length&&(t.rankMaxIndex="一"),"结束演练"==t.showMaxTitle&&(t.$store.state.loading=!1)}).catch(function(t){})},getLivingFlow:function(){var t=this;this.$axios.post("/api/list-live",{prefix:"php",limit:2}).then(function(a){t.pullKey=a.data.keys[0],t.getPullFlow()}).catch(function(t){console.log(t)})},getPullFlow:function(){var t=this;this.$axios.post("/api/get-play",{streamKey:this.pullKey}).then(function(a){t.videoOptions.sources[0].src=a.data}).catch(function(t){console.log(t)})}},filters:{markStatus1:function(t){return 0==t?"0":parseFloat(t).toFixed(1)}}},o={render:function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.$store.state.loading,expression:"$store.state.loading"}],staticClass:"maxPlay"},[s("img",{attrs:{src:e("oJ6p"),alt:""}}),t._v(" "),""!=t.videoMax&&"播放素材"==t.showMaxTitle?s("div",{staticClass:"play_max_video"},[s("video-player",{attrs:{options:t.videoOptions1}})],1):t._e(),t._v(" "),s("div",{staticClass:"max_main"},[s("div",{staticStyle:{height:"123px"}},["开始打分"==t.showMaxTitle?s("div",{staticClass:"start_score"},[t._m(0)]):t._e(),t._v(" "),"开始打分"!=t.showMaxTitle?s("div",{staticClass:"max_title"},[s("div",[t._v(t._s(t.showMaxTitle))])]):t._e(),t._v(" "),s("div",[t.showMaxClock?s("div",{staticClass:"max_clock"},[s("span",[t._v(t._s(t.max_time))]),t._v(" "),s("i",{staticClass:"iconfont el-icon-emergency-daojishi"})]):t._e()])]),t._v(" "),"播放素材"==t.showMaxTitle?s("div",{staticClass:"material_max"},[""==t.videoMax&&""==t.pictureMax?s("p",{staticClass:"text_max"},[t._v(t._s(t.textMax))]):t._e(),t._v(" "),""!=t.pictureMax?s("div",{staticClass:"show_img"},[s("img",{attrs:{src:t.$store.state.file_path+t.pictureMax}})]):t._e()]):t._e(),t._v(" "),"播放题目"==t.showMaxTitle||"开始答题"==t.showMaxTitle?s("div",{staticClass:"max_subject"},[s("h3",[t._v("请阅读下列题目")]),t._v(" "),s("p",[t._v("本题 "+t._s(t.subject.score)+" 分")]),t._v(" "),s("div",[t._v(t._s(t.subject.describe))]),t._v(" "),"开始答题"==t.showMaxTitle?s("div",{staticStyle:{"text-align":"center","font-size":"24px",color:"#fff","margin-top":"20px"}},[s("span",{staticStyle:{color:"#f00"}},[t._v(t._s(t.answerCounts))]),t._v(" 人已经完成答题!")]):t._e()]):t._e(),t._v(" "),"开始打分"==t.showMaxTitle?s("div",{staticStyle:{"text-align":"center","font-size":"24px",color:"#fff","font-weight":"500"}},[s("span",{staticStyle:{color:"#f00"}},[t._v(t._s(t.scoreUserCount))]),t._v(" 位评分人已经完成打分!")]):t._e(),t._v(" "),"显示所有组答案"==t.showMaxTitle||"开始打分"==t.showMaxTitle?s("div",{staticStyle:{"padding-top":"30px"}},[t.showMaxReference?s("div",{staticClass:"max_reference",style:"border-left: 10px solid "+t.maxRandomColor(4)},[s("div",{staticClass:"reference_title"},[t._v("参考答案")]),t._v(" "),s("div",{staticClass:"reference_content"},[s("div",{class:t.showMaxReferenceDetail?"":"showAllReferenceContent"},[s("span",[t._v(t._s(t.maxReference))])]),t._v(" "),t.showMaxReferenceDetail?t._e():s("p",{staticClass:"answer_detail",on:{click:function(a){t.showMaxReferenceDetail=!0}}},[s("span",[t._v("显示全部详情>>")])]),t._v(" "),t.showMaxReferenceDetail?s("p",{staticClass:"answer_detail",on:{click:function(a){t.showMaxReferenceDetail=!1}}},[s("span",[t._v("隐藏全部详情>>")])]):t._e()])]):t._e()]):t._e(),t._v(" "),"显示所有组答案"==t.showMaxTitle||"开始打分"==t.showMaxTitle?s("ul",{staticClass:"max_all_answer"},t._l(t.allAnswer,function(a,e){return s("li",{key:e,style:"border-left: 10px solid "+t.maxRandomColor(e)},[s("div",{staticClass:"group_name"},[t._v(t._s(a.name))]),t._v(" "),s("div",{staticClass:"answer"},[s("div",{class:a.show?"answer_roughly":""},[s("span",[t._v(t._s(a.answer))])]),t._v(" "),a.show?s("p",{staticClass:"answer_detail"},[s("span",{on:{click:function(e){t.maxAnswerDetail(a.id,a.show)}}},[t._v("显示全部详情>>")])]):t._e(),t._v(" "),a.show?t._e():s("p",{staticClass:"answer_detail"},[s("span",{on:{click:function(e){t.maxAnswerDetail(a.id,a.show)}}},[t._v("隐藏全部详情>>")])])])])})):t._e(),t._v(" "),"开始点评"==t.showMaxTitle?s("div",{staticClass:"max_comment"},[s("video-player",{attrs:{options:t.videoOptions}})],1):t._e(),t._v(" "),"展示得分"==t.showMaxTitle?s("div",{staticClass:"show_score"},[s("div",{staticClass:"score_title"},[t._v("得分排行榜")]),t._v(" "),s("p",{staticClass:"score_link"},[t._v("本环节得分")]),t._v(" "),s("ul",{staticClass:"score_group"},t._l(t.scoreLinkGroup,function(a,e){return s("li",{key:e},[s("p",[t._v(t._s(a.name))]),t._v(" "),s("span",[t._v(t._s(t._f("markStatus1")(a.score))+"分")])])})),t._v(" "),s("h3",[t._v("本次演练总排名")]),t._v(" "),s("div",{staticClass:"score_main"},t._l(t.maxScoreRank,function(a,e){return s("div",{key:e,staticClass:"every_group"},[s("div",{staticStyle:{float:"left"}},[s("img",{attrs:{src:a.src,alt:""}}),t._v(" "),s("span",{staticClass:"ranking"},[t._v("第 "),s("b",[t._v(t._s(e+1))]),t._v(" 名")]),t._v(" "),s("span",{staticClass:"group_name"},[t._v(t._s(a.name))])]),t._v(" "),s("div",{staticStyle:{float:"right",width:"420px"}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:a.group_score/t.scoreMaxTotal*100,status:"success"}}),t._v(" "),s("span",{staticStyle:{"margin-left":"10px","margin-right":"0","margin-top":"6px"}},[t._v(t._s(t._f("markStatus1")(a.group_score))+"分")])],1)])}))]):t._e(),t._v(" "),"结束演练"==t.showMaxTitle?s("div",{staticClass:"max_over"},[s("div",{staticClass:"over_drill_title"},[t._v("本次演练结束")]),t._v(" "),s("div",{staticClass:"the_fourth"},[t._v("前"+t._s(t.rankMaxIndex)+"甲")]),t._v(" "),s("div",{staticClass:"score_main"},t._l(t.maxScoreRank,function(a,e){return s("div",{key:e,staticClass:"every_group"},[s("div",{staticStyle:{float:"left"}},[s("img",{attrs:{src:a.src,alt:""}}),t._v(" "),s("span",{staticClass:"ranking"},[t._v("第 "),s("b",[t._v(t._s(e+1))]),t._v(" 名")]),t._v(" "),s("span",{staticClass:"group_name"},[t._v(t._s(a.name))])]),t._v(" "),s("div",{staticStyle:{float:"right",width:"420px"}},[s("el-progress",{attrs:{"text-inside":!0,"stroke-width":18,percentage:a.group_score/t.scoreMaxTotal*100,status:"success"}}),t._v(" "),s("span",{staticStyle:{"margin-left":"10px","margin-right":"0","margin-top":"6px"}},[t._v(t._s(t._f("markStatus1")(a.group_score))+"分")])],1)])}))]):t._e()])])},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",[this._v("正在打分中\n                    "),a("div",{staticClass:"loading"},[a("div",{staticClass:"object",attrs:{id:"object_one"}}),this._v(" "),a("div",{staticClass:"object",attrs:{id:"object_two"}}),this._v(" "),a("div",{staticClass:"object",attrs:{id:"object_three"}})])])}]};var n=e("VU/8")(i,o,!1,function(t){e("x+P2")},null,null);a.default=n.exports},oJ6p:function(t,a,e){t.exports=e.p+"static/img/max_bg2.1727a5e.png"},"x+P2":function(t,a){}});
//# sourceMappingURL=2.245d473fdb028450f532.js.map