webpackJsonp([6],{"8opi":function(t,s){},XyqY:function(t,s,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var e={data:function(){return{searchInput:"",stockSearchOptions:[{value:"1",label:"药品试剂"},{value:"2",label:"仪器设备"}],stockOptionsValue:"1",basicData:[],expands:[],pageIndex:1,pageTotal:0,manifestList:[],myManifestChooseList:[],is_editIndex:-1,showTextModel:!1,ruleForm:{describe:"",use:"",remarks:""},rules:{describe:[{required:!0,message:"请输入描述",trigger:"blur"}],use:[{required:!0,message:"请输入用途",trigger:"blur"}]},myName:"",myId:"",approver:"王伟强"}},created:function(){this.myName=JSON.parse(localStorage.getItem("user")).name,this.getAllList(),this.getUserId()},mounted:function(){document.getElementsByClassName("select_input")[0].childNodes[1].children[0].setAttribute("unselectable","on")},methods:{searchSortClick:function(){var t=this,s="";1==this.stockOptionsValue?s="药品试剂":2==this.stockOptionsValue&&(s="仪器设备"),this.$axios.post("/sort-item",{item_type:s,sort_name:this.searchInput,number:4}).then(function(s){if(t.expands=[],s.data.data)for(var a in t.basicData=s.data.data.data,t.pageTotal=s.data.data.total,t.basicData)for(var e in null==t.basicData[a].photo?t.basicData[a].pic=null:t.basicData[a].pic=t.basicData[i].photo.split("/")[1],t.basicData[a].list)for(var n in t.basicData[a].list[e].showRight=!1,t.basicData[a].list[e].is_NaN=!1,t.manifestList)t.manifestList[n].item_name==t.basicData[a].list[e].item_name&&(t.basicData[a].list[e].stock=t.manifestList[n].stock,""==t.basicData[a].list[e].stock||(isNaN(t.basicData[a].list[e].stock)?t.$set(t.basicData[a].list[e],"is_NaN",!0):Number(t.basicData[a].list[e].stock)<0?t.$set(t.basicData[a].list[e],"is_NaN",!0):(t.$set(t.basicData[a].list[e],"is_NaN",!1),t.$set(t.basicData[a].list[e],"showRight",!0))));else t.basicData=[],t.pageTotal=0}).catch(function(t){})},getUserId:function(){var t=this;this.$axios.post("/user-list").then(function(s){for(var a in s.data.data.data)s.data.data.data[a].name==t.myName&&(t.myId=s.data.data.data[a].id)})},getAllList:function(){var t=this,s="";1==this.stockOptionsValue?s="药品试剂":2==this.stockOptionsValue&&(s="仪器设备"),this.$axios.post("/sort-item",{item_type:s,number:4}).then(function(s){if(s.data.data)for(var a in t.basicData=s.data.data.data,t.pageTotal=s.data.data.total,t.basicData)null==t.basicData[a].photo?t.basicData[a].pic=null:t.basicData[a].pic=t.basicData[i].photo.split("/")[1];else t.basicData=[],t.pageTotal=0}).catch(function(t){})},ChangeType:function(){var t=this;this.searchInput="",this.pageIndex=1;var s="";1==this.stockOptionsValue?s="药品试剂":2==this.stockOptionsValue&&(s="仪器设备"),this.$axios.post("/sort-item",{item_type:s,number:4}).then(function(s){if(t.expands=[],s.data.data)for(var a in t.pageTotal=s.data.data.total,t.basicData=s.data.data.data,t.basicData)for(var e in null==t.basicData[a].photo?t.basicData[a].pic=null:t.basicData[a].pic=t.basicData[a].photo.split("/")[1],t.basicData[a].list)for(var i in t.basicData[a].list[e].showRight=!1,t.basicData[a].list[e].is_NaN=!1,t.manifestList)t.manifestList[i].item_name==t.basicData[a].list[e].item_name&&(t.basicData[a].list[e].stock=t.manifestList[i].stock,""==t.basicData[a].list[e].stock||(isNaN(t.basicData[a].list[e].stock)?t.$set(t.basicData[a].list[e],"is_NaN",!0):Number(t.basicData[a].list[e].stock)<0?t.$set(t.basicData[a].list[e],"is_NaN",!0):(t.$set(t.basicData[a].list[e],"is_NaN",!1),t.$set(t.basicData[a].list[e],"showRight",!0))));else t.pageTotal=0,t.basicData=[]}).catch(function(t){})},rowClick:function(t,s,a){Array.prototype.remove=function(t){var s=this.indexOf(t);s>-1&&this.splice(s,1)},this.expands.indexOf(t.id)<0?(this.expands=[],this.expands.push(t.id)):this.expands.remove(t.id)},handleCurrentChange:function(t){var s=this,a="";1==this.stockOptionsValue?a="药品试剂":2==this.stockOptionsValue&&(a="仪器设备"),this.$axios.post("/sort-item",{item_type:a,number:4,page:t}).then(function(t){if(s.expands=[],t.data.data)for(var a in s.pageTotal=t.data.data.total,s.basicData=t.data.data.data,s.basicData)for(var e in null==s.basicData[a].photo?s.basicData[a].pic=null:s.basicData[a].pic=s.basicData[a].photo.split("/")[1],s.basicData[a].list)for(var i in s.basicData[a].list[e].showRight=!1,s.basicData[a].list[e].is_NaN=!1,s.manifestList)s.manifestList[i].item_name==s.basicData[a].list[e].item_name&&(s.basicData[a].list[e].stock=s.manifestList[i].stock,""==s.basicData[a].list[e].stock||(isNaN(s.basicData[a].list[e].stock)?s.$set(s.basicData[a].list[e],"is_NaN",!0):Number(s.basicData[a].list[e].stock)<0?s.$set(s.basicData[a].list[e],"is_NaN",!0):(s.$set(s.basicData[a].list[e],"is_NaN",!1),s.$set(s.basicData[a].list[e],"showRight",!0))));else s.pageTotal=0,s.basicData=[]}).catch(function(t){})},chooseMyList:function(t,s){if(""==t.stock)for(var a in this.$set(t,"showRight",!1),this.manifestList)this.manifestList[a].item_name==t.item_name&&this.manifestList.splice(a,1);else if(isNaN(t.stock))for(var e in this.$set(t,"is_NaN",!0),this.$set(t,"showRight",!1),this.$message({type:"warning",message:"请输入数字!",duration:"1500"}),this.manifestList)this.manifestList[e].item_name==t.item_name&&this.manifestList.splice(e,1);else if(Number(t.stock)<0)for(var i in this.$set(t,"is_NaN",!0),this.$set(t,"showRight",!1),this.$message({type:"warning",message:"输入的值不能小于0!",duration:"1500"}),this.manifestList)this.manifestList[i].item_name==t.item_name&&this.manifestList.splice(i,1);else{this.$set(t,"is_NaN",!1),this.$set(t,"showRight",!0);var n=!0,o="";for(var l in this.manifestList)this.manifestList[l].item_name==t.item_name&&(n=!1,o=l);n?(t.unit=s,t.is_NaN=!1,this.manifestList.push(t)):(t.unit=s,t.is_NaN=!1,this.manifestList.splice(o,1,t))}},checkMyChoose:function(t){this.$set(t,"is_NaN",!1)},handleReceivedChange:function(t){this.myManifestChooseList=t},editClick:function(t){this.is_editIndex=t,this.expands=[],this.$nextTick(function(){this.$refs[t].focus()})},checkNumber:function(t){this.$set(t,"is_NaN",!1)},inputFocus:function(){this.expands=[]},editNumber:function(t){""==t.stock||(isNaN(t.stock)?(this.$set(t,"is_NaN",!0),this.$message({type:"warning",message:"请输入数字!",duration:"1500"})):Number(t.stock)<0?(this.$set(t,"is_NaN",!0),this.$message({type:"warning",message:"输入的值不能小于0!",duration:"1500"})):(this.$set(t,"is_NaN",!1),this.is_editIndex=-1))},removeRow:function(t){for(var s in this.manifestList)this.manifestList[s].item_name==t.item_name&&this.manifestList.splice(s,1);for(var a in this.basicData)for(var e in this.basicData[a].list)this.basicData[a].list[e].item_name==t.item_name&&(this.basicData[a].list[e].stock="",this.basicData[a].list[e].showRight=!1)},submitList:function(){var t=!0;for(var s in this.myManifestChooseList)if(console.log(this.myManifestChooseList[s]),this.myManifestChooseList[s].is_NaN){t=!1;break}t?this.showTextModel=!0:this.$message({type:"warning",message:"选中的数据有异常，请修改!",duration:"1500"})},closeModelBox:function(){this.$refs.ruleForm.resetFields(),this.ruleForm.remarks="",this.showTextModel=!1},submitForm:function(t){var s=this;this.$refs[t].validate(function(t){if(!t)return!1;s.$axios.post("/manifest-edit",{user_id:s.myId,approver:s.approver,item_use:s.ruleForm.use,remarks:s.ruleForm.remarks,describe:s.ruleForm.describe,apply:s.myManifestChooseList}).then(function(t){0==t.data.status&&(s.$message({type:"success",message:"申领提交成功!",duration:"1500"}),s.$refs.ruleForm.resetFields(),s.ruleForm.remarks="",s.myManifestChooseList=[],s.manifestList=[],s.expands=[],s.getAllList(),s.showTextModel=!1)})})}}},n={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"manifest"},[e("div",{staticClass:"search"},[e("div",{staticClass:"search_input el-input el-input--suffix"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.searchInput,expression:"searchInput"}],staticClass:"p_search el-input__inner",attrs:{autocomplete:"off",placeholder:"请按大类名称搜索",type:"text",rows:"2",validateevent:"true",suffixicon:"el-icon-search"},domProps:{value:t.searchInput},on:{keyup:function(s){if(!("button"in s)&&t._k(s.keyCode,"enter",13,s.key,"Enter")&&t._k(s.keyCode,"active",void 0,s.key,void 0))return null;t.searchSortClick()},input:function(s){s.target.composing||(t.searchInput=s.target.value)}}}),t._v(" "),e("span",{staticClass:"el-input__suffix",on:{click:function(s){t.searchSortClick()}}},[t._m(0)])]),t._v(" "),e("el-select",{staticClass:"select_input",on:{change:function(s){t.ChangeType()}},model:{value:t.stockOptionsValue,callback:function(s){t.stockOptionsValue=s},expression:"stockOptionsValue"}},t._l(t.stockSearchOptions,function(t){return e("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),e("el-table",{staticClass:"big_table",staticStyle:{width:"100%"},attrs:{"row-key":"id","expand-row-keys":t.expands,data:t.basicData,stripe:""},on:{"row-click":t.rowClick}},[e("el-table-column",{attrs:{prop:"id",label:"大类编号",width:"187.5"}}),t._v(" "),e("el-table-column",{attrs:{prop:"pic",label:"大类图片",width:"150"},scopedSlots:t._u([{key:"default",fn:function(s){return[1==t.stockOptionsValue?e("img",{attrs:{src:a("FGnH"),alt:""}}):t._e(),t._v(" "),2==t.stockOptionsValue?e("img",{attrs:{src:a("6mcn"),alt:""}}):t._e()]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"sort_name",label:"大类名称",width:"372"}}),t._v(" "),e("el-table-column",{attrs:{label:"数量"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",[t._v(t._s(s.row.list.length))]),1==t.stockOptionsValue?e("span",[t._v("瓶")]):t._e(),2==t.stockOptionsValue?e("span",[t._v("个")]):t._e()]}}])}),t._v(" "),e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("ul",t._l(s.row.list,function(a,i){return e("li",{key:i},[e("span",{staticClass:"name"},[t._v(t._s(a.item_name))]),e("el-input",{class:a.is_NaN?"is_NaN":"",attrs:{maxlength:"8"},on:{blur:function(e){t.chooseMyList(a,s.row.unit)}},nativeOn:{keyup:function(s){t.checkMyChoose(a)}},model:{value:a.stock,callback:function(s){t.$set(a,"stock",s)},expression:"item.stock"}}),t._v(" "),e("span",[t._v(t._s(s.row.unit))]),t._v(" "),e("i",{staticClass:"el-icon-check",style:a.showRight?"":"display:none;"})],1)}))]}}])})],1),t._v(" "),e("div",{staticClass:"block",staticStyle:{"text-align":"center","margin-top":"30px"}},[e("el-pagination",{attrs:{"current-page":t.pageIndex,"page-size":4,layout:"total, prev, pager, next, jumper",total:t.pageTotal},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(s){t.pageIndex=s}}})],1),t._v(" "),e("div",{staticClass:"btn"},[e("h3",[t._v("申领清单列表")]),t._v(" "),0!=t.myManifestChooseList.length?e("el-button",{on:{click:function(s){t.submitList()}}},[t._v("提交清单")]):t._e()],1),t._v(" "),e("el-table",{ref:"myManifestListTable",staticClass:"my_list",staticStyle:{width:"100%"},attrs:{data:t.manifestList,stripe:"","tooltip-effect":"dark","max-height":"300"},on:{"selection-change":t.handleReceivedChange}},[e("el-table-column",{attrs:{type:"selection",width:"97"}}),t._v(" "),e("el-table-column",{attrs:{prop:"item_name",label:"小类物品名称",width:"263"}}),t._v(" "),e("el-table-column",{attrs:{label:"申请数量",width:"351"},scopedSlots:t._u([{key:"default",fn:function(s){return[t.is_editIndex!=s.$index?e("span",{staticClass:"number_show",class:s.row.is_NaN?"is_false":""},[t._v(t._s(s.row.stock))]):t._e(),t.is_editIndex==s.$index?e("el-input",{ref:s.$index,staticClass:"input_click",class:s.row.is_NaN?"is_NaN":"",attrs:{maxlength:"8",autofocus:!0},on:{blur:function(a){t.editNumber(s.row)},focus:function(s){t.inputFocus()}},nativeOn:{keyup:function(a){t.checkNumber(s.row)}},model:{value:s.row.stock,callback:function(a){t.$set(s.row,"stock",a)},expression:"scope.row.stock"}}):t._e(),e("span",{staticStyle:{display:"inline-block"}},[t._v(t._s(s.row.unit))])]}}])}),t._v(" "),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("i",{staticClass:"iconfont el-icon-pharmaceutical_administration-xiugai",on:{click:function(a){t.editClick(s.$index)}}}),t._v(" "),e("i",{staticClass:"el-icon-close operating_click",on:{click:function(a){t.removeRow(s.row)}}})]}}])})],1),t._v(" "),t.showTextModel?e("div",{staticClass:"model_box"},[e("div",{staticClass:"form_box"},[e("div",{staticClass:"form_title"},[e("span",[t._v("提交清单")]),t._v(" "),e("i",{staticClass:"el-icon-close",on:{click:function(s){t.closeModelBox()}}})]),t._v(" "),e("div",{staticClass:"form_main"},[e("h3",[t._v("清单概况")]),t._v(" "),e("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"描述",prop:"describe"}},[e("el-input",{attrs:{resize:"none",type:"textarea"},model:{value:t.ruleForm.describe,callback:function(s){t.$set(t.ruleForm,"describe",s)},expression:"ruleForm.describe"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"用途",prop:"use"}},[e("el-input",{attrs:{resize:"none",type:"textarea"},model:{value:t.ruleForm.use,callback:function(s){t.$set(t.ruleForm,"use",s)},expression:"ruleForm.use"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"备注"}},[e("el-input",{attrs:{resize:"none",type:"textarea"},model:{value:t.ruleForm.remarks,callback:function(s){t.$set(t.ruleForm,"remarks",s)},expression:"ruleForm.remarks"}})],1),t._v(" "),e("div",{staticClass:"btn23"},[e("el-button",{attrs:{type:"primary"},on:{click:function(s){t.submitForm("ruleForm")}}},[t._v("确认并提交")])],1)],1)],1)])]):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("span",{staticClass:"el-input__suffix-inner"},[s("i",{staticClass:"el-input__icon iconfont el-icon-pharmaceutical_administration-sousuo"})])}]};var o=a("VU/8")(e,n,!1,function(t){a("8opi")},null,null);s.default=o.exports}});
//# sourceMappingURL=6.5e270915cebd4455abf7.js.map