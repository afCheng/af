webpackJsonp([9],{"K+lA":function(t,s){},st7O:function(t,s,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i={data:function(){return{project_id:"",count:{should:"",already:"",not:""},signLists:[],drawActLists:[],drawResultLists:[],allList:[],leaderLists:[],showDrawBtn:!0,showDrawResult:!1,groupList:[],groupName:"",timeDraw:"",groupLength:0,actCount:0}},created:function(){this.$store.state.showHeader="3",this.$store.state.loading=!0,this.project_id=localStorage.drill_project,this.getDrawList()},mounted:function(){var t=this;this.timeDraw=setInterval(function(){0!=t.drawResultLists.length&&clearInterval(t.timeDraw),t.getDrawList()},5e3),this.getGroupType()},methods:{startDirectDrill:function(){var t=this,s=this;this.groupName&&this.$axios.post("/api/the-draw",{design_id:this.project_id}).then(function(s){0==s.data.data[0].user.length&&(t.drawClick(),t.$axios.post("/api/draw-lots",{sign:t.allList}).then(function(t){}))}).catch(function(t){}),this.$axios.post("/api/start",{design_id:this.project_id}).then(function(t){0==t.data.status&&s.$router.push("/direct/start")}).catch(function(t){})},openBigView:function(){var t=window.location.host;window.open("http://"+t+this.$store.state.maxGroup_path)},getDrawList:function(){var t=this;this.$axios.post("/api/user-sign",{design_id:this.project_id}).then(function(s){var a=[],i=[],e=[];if("0"==s.data.status){if(0==s.data.data.score_user.length)for(var r in s.data.data)a.push(s.data.data[r]);else{for(var n in s.data.data)a.push(s.data.data[n]);a.pop(),a.push(s.data.data.score_user[0])}for(var o in a)"1"==a[o].character&&i.push(a[o]),"0"!=a[o].character&&e.push(a[o])}t.signLists=e,t.drawActLists=i,t.count.should=t.signLists.length;var u=0,c=0;for(var d in t.signLists)"1"==t.signLists[d].user_status&&(u++,"1"==t.signLists[d].character&&c++);t.actCount=c,t.count.already=u}).catch(function(){})},getGroupType:function(){var t=this;this.$axios.post("/api/group-start",{design_id:this.project_id}).then(function(s){t.groupLength=s.data.data.length,s.data.data&&(t.groupList=s.data.data,"此演练不分组"==s.data.data[0].name?(t.showDrawBtn=!1,t.groupName="此演练不分组",t.$store.state.loading=!1):t.$axios.post("/api/the-draw",{design_id:t.project_id}).then(function(s){if(0==s.data.data[0].user.length)t.showDrawResult=!1,t.showDrawBtn=!0;else{t.showDrawResult=!0,t.showDrawBtn=!1;var a=s.data.data;for(var i in s.data.data)for(var e in s.data.data[i].user)a[i].user[e].section_one=a[i].user[e].section.section_one,a[i].user[e].section_two=a[i].user[e].section.section_two,a[i].user[e].user_name=a[i].user[e].name;t.drawResultLists=a}t.$store.state.loading=!1}).catch(function(t){}))}).catch(function(t){})},drawClick:function(){var t=[];for(var s in this.drawActLists)1==this.drawActLists[s].user_status&&t.push(this.drawActLists[s]);for(var a=this.groupList,i=Math.ceil(t.length/a.length),e=0;e<a.length;e++){a[e].user=[];for(var r=0;r<t.length;r++){var n=i*(e+1);Number(i*e)<=Number(r)&&Number(r)<Number(n)&&a[e].user.push(t[r])}}this.drawResultLists=a;var o=[];for(var u in this.drawResultLists)for(var c in this.drawResultLists[u].user)o.push({user_id:this.drawResultLists[u].user[c].user_id,group_id:this.drawResultLists[u].id});this.allList=o;var d=[];for(var l in this.drawResultLists)d.push({group_id:this.drawResultLists[l].id,user_id:this.drawResultLists[l].user[0].user_id});this.leaderLists=d},drawBtnClick:function(){this.$store.state.loading=!0,this.drawClick();var t=this;this.$axios.post("/api/draw-lots",{sign:this.allList,group_user:this.leaderLists}).then(function(s){"0"==s.data.status?(t.showDrawBtn=!1,t.showDrawResult=!0):(t.showDrawBtn=!0,t.showDrawResult=!1),t.$store.state.loading=!1}).catch(function(t){})}}},e={render:function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.$store.state.loading,expression:"$store.state.loading"}],staticClass:"directGrouping"},[t._m(0),t._v(" "),a("div",{staticClass:"direct_main"},[a("h3",[t._v("参演人员签到列表")]),t._v(" "),a("div",{staticStyle:{float:"right"}},[t.showDrawBtn?a("div",{staticStyle:{float:"right"}},[t.actCount<t.groupLength?a("el-button",{attrs:{type:"primary",disabled:""}},[t._v("抽签")]):t._e(),t._v(" "),t.actCount>=t.groupLength?a("el-button",{attrs:{type:"primary"},on:{click:function(s){t.drawBtnClick()}}},[t._v("抽签")]):t._e()],1):t._e(),t._v(" "),t.showDrawBtn?t._e():a("el-button",{attrs:{type:"primary"},on:{click:function(s){t.startDirectDrill()}}},[t._v("开始演练")]),t._v(" "),a("el-button",{staticStyle:{padding:"8px 30px","margin-right":"5px"},attrs:{type:"primary"},on:{click:function(s){t.openBigView()}}},[t._v("打开投影页面")])],1),t._v(" "),a("div",{staticClass:"should"},[a("p",[a("span",[t._v("应到人数 "+t._s(t.count.should))]),t._v(" "),a("span",[t._v("已到人数 "),a("span",{staticStyle:{color:"#4a90e2"}},[t._v(t._s(t.count.already))])]),t._v(" "),a("span",[t._v("未到人数 "),a("span",{staticStyle:{color:"#d0021b"}},[t._v(t._s(t.count.should-t.count.already))])])]),t._v(" "),a("div",{staticClass:"direct_detail"},[a("div",{staticStyle:{"font-size":"16px",height:"25px","line-height":"25px","margin-bottom":"10px"}},[t._v("参演者")]),t._v(" "),a("ul",t._l(t.signLists,function(s,i){return 1==s.character?a("li",{key:i,class:"1"==s.user_status?"already_sign":""},[a("i",{staticClass:"iconfont el-icon-emergency-dagou1"}),t._v(" "),a("span",[t._v(t._s(s.user_name))]),t._v(" "),a("span",[t._v(t._s(s.section_one)+t._s(s.section_two))])]):t._e()})),t._v(" "),a("div",{staticStyle:{"font-size":"16px",height:"25px","line-height":"25px","margin-bottom":"10px"}},[t._v("点评或评分人")]),t._v(" "),a("ul",t._l(t.signLists,function(s,i){return 1!=s.character?a("li",{key:i,class:"1"==s.user_status?"already_sign":""},[a("i",{staticClass:"iconfont el-icon-emergency-dagou1"}),t._v(" "),a("span",[t._v(t._s(s.user_name))]),t._v(" "),a("span",[t._v(t._s(s.section_one)+t._s(s.section_two))])]):t._e()}))])]),t._v(" "),t.showDrawBtn?t._e():a("h3",[t.showDrawResult?a("span",[t._v("抽签结果")]):t._e()]),t._v(" "),t.showDrawResult?a("div",{staticClass:"draw_result"},[a("ul",t._l(t.drawResultLists,function(s,i){return a("li",{key:i},[a("div",{staticClass:"groupName"},[t._v(t._s(s.name))]),t._v(" "),a("div",{staticClass:"groupList"},t._l(s.user,function(s,i){return a("p",{key:i},[a("span",[t._v(t._s(s.user_name))]),t._v(" "),a("span",[t._v(t._s(s.section_one)+t._s(s.section_two))])])}))])}))]):t._e()])])},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"direct_title"},[s("div",{staticStyle:{color:"#4a90e2"}},[this._v("签到分组")])])}]};var r=a("VU/8")(i,e,!1,function(t){a("K+lA")},null,null);s.default=r.exports}});
//# sourceMappingURL=9.cc02f442b18c7528ae4c.js.map